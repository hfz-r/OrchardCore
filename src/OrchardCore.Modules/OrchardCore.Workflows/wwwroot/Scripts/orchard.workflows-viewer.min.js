var WorkflowCanvas=function(t,n){var c=this;this.container=t,this.workflowType=n,this.minCanvasHeight=400,this.getActivityElements=function(){return $(c.container).find(".activity")},this.getDefaults=function(){return{Anchor:"Continuous",DragOptions:{cursor:"pointer",zIndex:2e3},EndpointStyles:[{fillStyle:"#225588"}],Endpoints:[["Dot",{radius:7}],["Blank"]],ConnectionOverlays:[["Arrow",{width:12,length:12,location:-5}]],ConnectorZIndex:5}},this.createJsPlumbInstance=function(){return jsPlumb.getInstance({DragOptions:{cursor:"pointer",zIndex:2e3},ConnectionOverlays:[["Arrow",{location:1,visible:!0,width:11,length:11}],["Label",{location:.5,id:"label",cssClass:"connection-label"}]],Container:c.container})},this.getEndpointColor=function(t){return t.isBlocking||t.isStart?"#7ab02c":t.isEvent?"#3a8acd":"#7ab02c"},this.getSourceEndpointOptions=function(t,n){var o=c.getEndpointColor(t);return{endpoint:"Dot",anchor:"Continuous",paintStyle:{stroke:o,fill:o,radius:7,strokeWidth:1},isSource:!0,connector:["Flowchart",{stub:[40,60],gap:0,cornerRadius:5,alwaysRespectStubs:!0}],connectorStyle:{strokeWidth:2,stroke:"#999999",joinstyle:"round",outlineStroke:"white",outlineWidth:2},hoverPaintStyle:{fill:"#216477",stroke:"#216477"},connectorHoverStyle:{strokeWidth:3,stroke:"#216477",outlineWidth:5,outlineStroke:"white"},connectorOverlays:[["Label",{location:[3,-1.5],cssClass:"endpointSourceLabel"}]],dragOptions:{},uuid:t.id+"-"+n.name,parameters:{outcome:n}}},this.getActivity=function(n,t){return void 0===t&&(t=null),t||(t=this.workflowType.activities),$.grep(t,function(t){return t.id===n})[0]},this.updateConnections=function(t){for(var n=c.workflowType.id,o=0,e=c.workflowType.transitions;o<e.length;o++){var i=e[o],r=i.sourceActivityId+"-"+i.sourceOutcomeName,a=t.getEndpoint(r),s="activity-"+n+"-"+i.destinationActivityId;t.connect({source:a,target:s})}},this.updateCanvasHeight=function(){for(var t=$(this.container),n=0,o=0,e=0,i=t.find(".activity").toArray();e<i.length;e++){var r=i[e],a=$(r),s=a.position().top;n<s&&(n=s,o=a.height())}var c=n+o;c-(n+o)<=100&&(c+=100),t.height(Math.max(this.minCanvasHeight,c))}},__extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),WorkflowViewer=function(o){function t(t,n){var l=o.call(this,t,n)||this;l.container=t,l.workflowType=n,l.getEndpointColor=function(t){return t.isBlocking?"#7ab02c":t.isEvent?"#3a8acd":"#7ab02c"};return jsPlumb.ready(function(){jsPlumb.importDefaults(l.getDefaults());var c=l.createJsPlumbInstance();c.bind("connection",function(t,n){var o=t.connection,e=o.getParameters().outcome;o.getOverlay("label").setLabel(e.displayName)});var t=l.getActivityElements();c.batch(function(){l.workflowType.id;t.each(function(t,n){var o=$(n).data("activity-id"),e=l.getActivity(o);c.makeTarget(n,{dropOptions:{hoverClass:"hover"},anchor:"Continuous",endpoint:["Blank",{radius:8}]});for(var i=0,r=e.outcomes;i<r.length;i++){var a=r[i],s=l.getSourceEndpointOptions(e,a);c.addEndpoint(n,{connectorOverlays:[["Label",{label:a.displayName,cssClass:"connection-label"}]]},s)}}),l.updateConnections(c),(t=l.getActivityElements()).show(),l.updateCanvasHeight()}),l.jsPlumbInstance=c}),l}return __extends(t,o),t}(WorkflowCanvas);$.fn.workflowViewer=function(){return this.each(function(t,n){var o=$(n),e=o.data("workflow-type");o.data("workflowViewer",new WorkflowViewer(n,e))}),this},$(document).ready(function(){$(".workflow-canvas").workflowViewer().data("workflowViewer")});
